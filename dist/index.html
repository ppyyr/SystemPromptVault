<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="common.appTitle">System Prompt Vault</title>
    <!-- 防止主题闪烁 - 必须在页面渲染前执行 -->
    <script>
      (function() {
        const theme = localStorage.getItem('app-theme') ||
          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
    <link rel="stylesheet" href="css/output.css" />
    <!-- 保留原有样式以确保平滑过渡 -->
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/components.css" />
    <!-- 第三方库：marked.js、DOMPurify 通过 ES Modules 在 main.js 中导入 -->
    <!-- Monaco Editor (CDN) - 必须最后加载以避免 AMD define 冲突 -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.50.0/min/vs/loader.js"></script>
  </head>
  <body class="bg-gray-100 dark:bg-gray-900 h-screen text-gray-900 dark:text-gray-100">
    <div class="h-full mx-auto p-5 flex flex-col gap-6">
      <header class="flex items-center justify-between gap-3">
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white" data-i18n="clients.header">Clients</h1>
        <div class="flex items-center gap-2">
          <div id="themeToggleContainer"></div>
          <a
            class="bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-md px-4 py-2 font-semibold hover:border-primary hover:text-primary dark:hover:border-primary dark:hover:text-primary hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200"
            href="settings.html"
            data-i18n="common.settings"
          >
            Settings
          </a>
        </div>
      </header>

      <div id="splitContainer" class="flex flex-col gap-4 lg:flex-row lg:gap-0 flex-1">
        <section id="configSection" class="resizable-panel bg-white border border-gray-200 dark:border-gray-700 rounded-lg p-5 shadow-sm flex flex-col gap-4 min-h-[520px] w-full lg:flex-none" style="background: rgba(255, 255, 255, 0.95);">
          <style>
            .dark #configSection {
              background: rgba(15, 23, 42, 0.9) !important;
              border-color: rgba(148, 163, 184, 0.2) !important;
            }
          </style>
          <div class="grid grid-cols-3 items-center gap-3">
            <div class="client-dropdown" id="clientDropdown">
              <button
                type="button"
                class="client-dropdown__toggle"
                id="clientDropdownToggle"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-controls="clientDropdownPanel"
                aria-label="Select Client"
                data-i18n-aria="clients.selectClient"
              >
                <span class="client-dropdown__label" id="clientDropdownLabel" data-i18n="clients.selectClient">Select Client</span>
                <svg class="client-dropdown__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"></path>
                </svg>
              </button>
              <div
                class="client-dropdown__panel"
                id="clientDropdownPanel"
                role="listbox"
                aria-label="Client List"
                data-i18n-aria="clients.listAria"
                aria-hidden="true"
              >
                <div class="client-dropdown__list" id="clientDropdownList"></div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <div id="configFileSelectContainer">
                <div class="client-dropdown" id="configFileDropdown">
                  <button
                    type="button"
                    class="client-dropdown__toggle"
                    id="configFileDropdownToggle"
                    aria-haspopup="listbox"
                    aria-expanded="false"
                    aria-controls="configFileDropdownPanel"
                    aria-label="Select config file"
                    data-i18n-aria="config.selectFile"
                  >
                    <span class="client-dropdown__label" id="configFileDropdownLabel">Select File</span>
                    <svg class="client-dropdown__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                      <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"></path>
                    </svg>
                  </button>
                  <div
                    class="client-dropdown__panel"
                    id="configFileDropdownPanel"
                    role="listbox"
                    aria-label="Config File List"
                    aria-hidden="true"
                  >
                    <div class="client-dropdown__list" id="configFileDropdownList"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex items-center gap-2 justify-end">
              <button
                class="btn-icon btn-icon-primary"
                id="btnSaveConfig"
                type="button"
                aria-label="Save"
                data-tooltip="Save"
                data-i18n-aria="actions.saveConfig"
                data-i18n-tooltip="actions.saveConfig"
              >
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                  <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path>
                  <path d="M17 21v-8H7v8M7 3v5h8"></path>
                </svg>
              </button>
              <button
                class="btn-icon btn-icon-secondary"
                id="btnToggleEditorMode"
                type="button"
                aria-label="Switch Edit/Preview Mode"
                data-tooltip="Preview"
                data-i18n-aria="editor.toggleMode"
                data-i18n-tooltip="editor.preview"
              >
                <svg class="w-5 h-5" id="iconEditMode" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <svg class="w-5 h-5 hidden" id="iconPreviewMode" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="config-editor-shell flex-1">
            <div
              id="monacoEditorContainer"
              class="monaco-editor-container"
              role="region"
              aria-label="Config File Editor"
              data-i18n-aria="editor.editorRegion"
            ></div>
            <div
              id="markdownPreview"
              class="markdown-preview hidden"
              role="region"
              aria-label="Config Preview"
              data-i18n-aria="editor.previewRegion"
            >
              <div class="markdown-preview__body prose prose-sm dark:prose-invert max-w-none"></div>
            </div>
          </div>
        </section>

        <div id="splitResizer" class="split-resizer hidden lg:flex flex-col cursor-col-resize transition-all duration-300 items-center justify-center" aria-hidden="true">
          <div class="split-resizer__grip pointer-events-none flex flex-col items-center gap-2">
            <span class="split-resizer__track"></span>
            <div class="split-resizer__dots flex flex-col items-center gap-1.5">
              <span class="split-resizer__dot block rounded-full bg-current"></span>
              <span class="split-resizer__dot block rounded-full bg-current"></span>
              <span class="split-resizer__dot block rounded-full bg-current"></span>
            </div>
          </div>
        </div>

        <section id="promptSection" class="resizable-panel bg-white border border-gray-200 dark:border-gray-700 rounded-lg p-5 shadow-sm flex flex-col gap-4 min-h-[520px] w-full lg:flex-none" style="background: rgba(255, 255, 255, 0.95);">
          <style>
            .dark #promptSection {
              background: rgba(15, 23, 42, 0.9) !important;
              border-color: rgba(148, 163, 184, 0.2) !important;
            }
          </style>
          <div class="flex items-center justify-between gap-3 flex-nowrap">
            <h3 class="text-base font-semibold text-gray-900 dark:text-white whitespace-nowrap" data-i18n="prompts.sectionTitle">Prompts</h3>
            <div class="tag-filter tag-dropdown" id="tagFilter">
              <button
                type="button"
                class="tag-dropdown__toggle"
                id="tagDropdownToggle"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-controls="tagDropdownPanel"
                aria-label="Filter Tags"
                data-tooltip="Filter Tags"
                data-i18n-aria="tags.filter"
                data-i18n-tooltip="tags.filter"
              >
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" focusable="false">
                  <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"></path>
                </svg>
                <span class="tag-dropdown__badge hidden" id="tagDropdownBadge" aria-live="polite">0</span>
                <svg class="tag-dropdown__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                  <path fill="currentColor" d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"></path>
                </svg>
              </button>
              <div
                class="tag-dropdown__panel"
                id="tagDropdownPanel"
                role="dialog"
                aria-label="Tag Filter"
                data-i18n-aria="tags.panelAria"
                aria-hidden="true"
                tabindex="-1"
              >
                <div class="tag-dropdown__search">
                  <label for="tagDropdownSearch" class="sr-only" data-i18n="tags.searchLabel">Search Tags</label>
                  <input
                    type="text"
                    id="tagDropdownSearch"
                    class="tag-dropdown__search-input"
                    placeholder="Search tags..."
                    data-i18n-placeholder="tags.searchPlaceholder"
                    autocomplete="off"
                    spellcheck="false"
                    aria-label="Search Tags"
                    data-i18n-aria="tags.searchLabel"
                  />
                </div>
                <div class="tag-dropdown__section" aria-label="Recently Used Tags" data-i18n-aria="tags.recentlyUsedAria">
                  <div class="tag-dropdown__section-header">
                    <span class="tag-dropdown__section-title" data-i18n="tags.recentlyUsed">Recently Used</span>
                  </div>
                  <div
                    class="tag-dropdown__list"
                    id="tagDropdownRecent"
                    role="listbox"
                    aria-multiselectable="true"
                  ></div>
                </div>
                <div class="tag-dropdown__section" aria-label="All Tags" data-i18n-aria="tags.allTagsAria">
                  <div class="tag-dropdown__section-header">
                    <span class="tag-dropdown__section-title" data-i18n="tags.allTags">All Tags</span>
                    <span class="tag-dropdown__count" id="tagDropdownCount"></span>
                  </div>
                  <div
                    class="tag-dropdown__list"
                    id="tagDropdownList"
                    role="listbox"
                    aria-multiselectable="true"
                  ></div>
                </div>
              </div>
            </div>
          </div>
          <div class="flex-1 flex flex-col gap-0 overflow-y-auto pr-1" id="promptList"></div>
        </section>
      </div>
    </div>

    <div id="promptTooltip" class="prompt-tooltip hidden" role="dialog" aria-live="polite" aria-hidden="true">
      <div class="prompt-tooltip-header" aria-live="off">
        <h4 class="prompt-tooltip-title"></h4>
        <button
          type="button"
          class="prompt-tooltip-pin-button"
          aria-label="Pin Prompt"
          data-i18n-aria="prompts.pinTooltip"
          aria-pressed="false"
          data-action="pin-tooltip"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 17v5" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z" />
          </svg>
        </button>
      </div>
      <div class="prompt-tooltip-tags"></div>
      <pre class="prompt-tooltip-content"></pre>
      <div class="prompt-tooltip-resize-handle" aria-hidden="true"></div>
    </div>

    <div id="toastContainer" class="fixed top-4 right-4 z-[1800] max-w-sm" role="status" aria-live="polite"></div>

    <div
      id="loadingOverlay"
      class="fixed inset-0 z-[2000] flex items-center justify-center bg-black/50 hidden"
      aria-hidden="true"
      role="alert"
      aria-label="Processing"
      data-i18n-aria="common.processing"
    >
      <div class="bg-white dark:bg-gray-800 rounded-lg p-6 flex items-center gap-3">
        <div class="animate-spin rounded-full h-6 w-6 border-2 border-primary border-t-transparent"></div>
        <span class="text-gray-900 dark:text-white" data-i18n="common.processingText">Processing...</span>
      </div>
    </div>

    <div id="buttonTooltip" class="button-tooltip hidden" role="tooltip" aria-hidden="true"></div>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
