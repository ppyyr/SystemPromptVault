# 快照功能使用指南

## 📸 快照功能概述

快照功能为您的配置文件提供轻量级的版本管理，支持自动备份和快速恢复。您可以随时回到之前的配置状态，避免误操作导致的配置丢失。

## ✨ 核心特性

- ✅ **自动快照**：启动应用和切换客户端时自动备份
- ✅ **手动快照**：支持自定义命名的快照
- ✅ **快速恢复**：通过System Tray一键恢复历史配置
- ✅ **智能清理**：自动保留最近的N个快照（可配置）
- ✅ **客户端隔离**：每个客户端的快照独立管理

## 📋 快照类型

### 🚀 启动时自动快照
- **触发时机**：每次打开应用时
- **命名格式**：`启动时自动快照 2025-11-10 09:30`
- **用途**：保留应用启动时的配置状态，方便对比当天的修改

### 🔄 切换客户端自动快照
- **触发时机**：从客户端A切换到客户端B之前
- **命名格式**：`自动保存 2025-11-10 14:20`
- **用途**：保留切换前的配置状态，防止数据丢失

### ✨ 手动快照
- **触发方式**：
  - **方式1**：按住 `Shift` 键点击"保存"按钮
  - **方式2**：按下快捷键 `Shift+Cmd+S` (macOS) 或 `Shift+Ctrl+S` (Windows/Linux)
- **命名**：弹出输入框，输入自定义快照名称
- **用途**：在重要修改前手动创建快照，方便后续对比

## 🎯 使用场景

### 场景1：测试新配置前备份
```
1. 当前配置运行良好
2. 按 Shift+Cmd+S 创建快照「稳定版配置」
3. 修改配置进行测试
4. 如果测试失败，通过托盘菜单恢复「稳定版配置」
```

### 场景2：切换客户端时自动保护
```
1. 正在编辑 Claude 的配置
2. 点击切换到 ChatGPT 客户端
3. 系统自动创建「自动保存 2025-11-10 14:20」快照
4. 稍后可通过托盘菜单恢复 Claude 的配置
```

### 场景3：回到今天的起始状态
```
1. 今天对配置做了多次修改
2. 想恢复到今天刚打开应用时的状态
3. 找到托盘菜单中的「启动时自动快照 2025-11-10 09:00」
4. 点击即可恢复
```

## 🖱️ System Tray 快照菜单

### 菜单结构
```
SystemPromptVault
├── 📋 Client: Claude (5个快照)
│   ├── ✨ 稳定版配置 (手动)
│   ├── 🔄 自动保存 2025-11-10 14:20
│   ├── 🔄 自动保存 2025-11-10 11:45
│   ├── 🚀 启动时自动快照 2025-11-10 09:30
│   └── ✨ 优化后的提示词 (手动)
├── 📋 Client: ChatGPT (3个快照)
│   ├── 🔄 自动保存 2025-11-10 13:15
│   ├── 🚀 启动时自动快照 2025-11-10 09:30
│   └── ✨ 简洁版配置 (手动)
├── ---
├── 🏠 打开主窗口
└── ❌ 退出
```

### 图标说明
- **✨**：手动创建的快照（用户自定义名称）
- **🔄**：切换客户端时的自动快照
- **🚀**：启动应用时的自动快照

### 恢复快照
1. 左键点击托盘图标（macOS系统）
2. 选择对应客户端的子菜单
3. 点击要恢复的快照
4. 配置文件立即更新，系统显示通知

⚠️ **注意**：恢复快照会直接覆盖当前配置，请提前保存重要修改！

## ⚙️ 快照管理设置

### 打开设置页面
1. 点击主界面右上角的"设置"按钮
2. 或通过托盘菜单选择"🏠 打开主窗口" → 点击"设置"

### 常规设置 (General Settings)

#### 配置最大快照数量
1. 在设置页面选择"常规设置"选项卡
2. 修改"最大快照保存数量"（范围1-20，默认5）
3. 点击"保存设置"

**清理规则**：
- 超过限制时，自动删除**最旧的快照**（FIFO策略）
- 每个客户端独立配置
- 修改后立即生效

**推荐配置**：
- **轻度使用**：5个快照（默认）
- **频繁修改**：10-15个快照
- **重度用户**：20个快照（最大值）

### 快照管理 (Snapshots Management)

#### 查看快照列表
1. 在设置页面选择"快照管理"选项卡
2. 选择要查看的客户端
3. 查看该客户端的所有快照（按时间降序排列）

#### 删除快照
1. 找到要删除的快照行
2. 点击"删除"按钮
3. 确认删除操作

#### 重命名快照
1. 找到要重命名的快照行
2. 点击"重命名"按钮
3. 输入新的快照名称
4. 确认修改

#### 手动刷新列表
- 点击右上角的"刷新"按钮
- 重新加载当前客户端的快照列表

## 📊 快照信息说明

### 快照列表列
| 列名 | 说明 | 示例 |
|------|------|------|
| **快照名称** | 快照的显示名称 | `稳定版配置` |
| **创建时间** | 快照创建的本地时间 | `2025-11-10 14:20:30` |
| **类型** | 自动/手动 | `手动` 或 `自动` |
| **操作** | 可执行的操作按钮 | 重命名、删除 |

### 排序规则
- 快照列表按**创建时间降序**排列
- 最新的快照显示在最上方
- 托盘菜单遵循相同的排序规则

## 💡 使用技巧

### 技巧1：快速创建命名快照
- 使用简短清晰的名称（如"v1.0"、"优化版"）
- 在重要修改前创建快照
- 建议在快照名称中注明修改内容

### 技巧2：利用自动快照
- 每天的第一个快照是"启动时快照"，可作为当天的起点
- 切换客户端前的快照可作为临时备份
- 自动快照无需手动管理，系统自动清理

### 技巧3：避免快照混乱
- 定期删除不需要的手动快照
- 为重要快照使用描述性名称
- 合理设置最大快照数量，避免存储过多无用快照

### 技巧4：快照恢复最佳实践
- 恢复前确认当前配置已保存（如果需要）
- 从托盘菜单快速恢复，无需打开主窗口
- 恢复后检查配置文件内容是否正确

## 🔍 故障排查

### 问题1：托盘菜单不显示快照
**可能原因**：
- 应用未启动托盘功能
- 快照文件损坏

**解决方法**：
1. 重启应用
2. 在设置页面手动刷新快照列表
3. 查看Console日志检查错误信息

### 问题2：快照恢复后内容不对
**可能原因**：
- 恢复的不是目标快照
- 快照创建时内容本身有误

**解决方法**：
1. 在设置页面查看快照创建时间
2. 恢复其他快照尝试
3. 手动编辑配置文件

### 问题3：快照数量超过限制
**可能原因**：
- 手动创建了大量快照
- `max_snapshots` 设置过小

**解决方法**：
1. 在"常规设置"中增加最大快照数量
2. 在"快照管理"中手动删除旧快照
3. 保存设置后系统自动清理

### 问题4：手动快照创建失败
**可能原因**：
- 快照名称为空
- 文件系统权限问题

**解决方法**：
1. 确保输入了非空快照名称
2. 检查应用是否有文件写入权限
3. 查看Console日志获取详细错误信息

## 📚 相关文档

- [快照版本管理系统技术文档](../llmdoc/features/snapshot-version-management.md)：开发者文档
- [项目整体架构设计](../llmdoc/architecture/systemprompt-vault-architecture.md)：系统架构说明

## ❓ 常见问题

### Q1：快照会占用多少存储空间？
**A**：每个快照存储一份完整的配置文件文本。典型的配置文件大小为1-10KB，5个快照约占用5-50KB，存储占用极小。

### Q2：快照数据保存在哪里？
**A**：快照保存在应用数据目录的 `snapshots/{client_id}.json` 文件中。
- **macOS**: `~/Library/Application Support/com.systemprompt.vault/snapshots/`
- **Windows**: `%APPDATA%\com.systemprompt.vault\snapshots\`
- **Linux**: `~/.config/com.systemprompt.vault/snapshots/`

### Q3：可以导出快照吗？
**A**：当前版本暂不支持快照导出。您可以直接复制快照文件进行备份。未来版本将支持快照导出/导入功能。

### Q4：删除快照后可以恢复吗？
**A**：快照删除后无法恢复，请谨慎操作。建议在删除前确认不再需要该快照。

### Q5：自动快照会影响性能吗？
**A**：不会。快照创建是异步操作，不阻塞主线程。典型的快照创建耗时小于10ms，对用户体验无影响。

### Q6：快照支持多设备同步吗？
**A**：当前版本不支持。快照仅存储在本地设备。未来版本可能支持云同步功能（可选）。

## 📞 反馈与支持

如有问题或建议，请通过以下方式联系：
- GitHub Issues: [项目仓库Issues页面]
- 邮件支持: [support@systemprompt.vault]

---

**版本**: v0.1.0
**最后更新**: 2025-11-10
**文档作者**: SystemPromptVault 开发团队
